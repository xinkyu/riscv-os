# 实验二：内核 `printf` 与清屏

## 实验目标

在实验一的基础上，为内核实现一个功能类似标准库的 `printf` 函数，提供格式化输出能力，这是后续内核开发和调试不可或缺的工具。同时，实现一个清屏函数以优化控制台的显示效果。

## 核心实现 (`kernel/printf.c`)

### 1. `printf` 函数

#### 可变参数处理
`printf` 函数需要接受不定数量的参数。我们通过引入 `<stdarg.h>` 头文件并使用其提供的宏来实现： 
* `va_list`: 用于定义一个指向参数列表的指针。
* `va_start`: 初始化 `va_list` 指针，使其指向第一个可变参数。
* `va_arg`: 从 `va_list` 中按类型取出下一个参数。
* `va_end`: 清理 `va_list`。

#### 格式化字符串解析
函数的核心是一个循环，逐个字符地解析格式字符串 `fmt`。
* 如果当前字符不是 `%`，则直接通过 `cons_putc` 输出。
* 如果遇到 `%`，则检查其后的字符（格式说明符），并根据说明符的类型（如 `d`, `x`, `s`, `c`, `%`）采取不同的动作。

#### 数字到字符串转换
为了支持 `%d` (十进制) 和 `%x` (十六进制)，我们实现了一个辅助函数 `print_int`。
* **转换算法**: 采用“循环取模-除法”的策略。例如，对于十进制，反复对 10 取模得到最低位的数字，然后将原数除以 10，直到原数变为 0。
* **逆序输出**: 上述算法得到的数字顺序是颠倒的，因此我们先将结果存入一个字符缓冲区，再反向打印出来，从而得到正确的顺序。
* **负数处理**: 对于带符号的十进制数，先打印一个负号，然后将其转换为正数再进行处理。

### 2. 清屏函数 (`clear_screen`)

为了方便观察输出，我们实现了一个清屏函数。它通过向串口发送标准的 **ANSI 转义序列** 来工作。
* `\033[2J`: 清除整个屏幕。
* `\033[H`: 将光标移动到屏幕的左上角（第一行第一列）。

## 测试

`main.c` 中设计了全面的测试用例，覆盖了所有支持的格式说明符，并包括了边界条件测试，如打印负数、0、`INT_MAX`、空指针字符串和空字符串等。

## 实验结果

执行 `make run` 后，QEMU 终端首先清屏，然后正确地打印出所有测试用例的格式化输出，表明 `printf` 功能完善且稳定。